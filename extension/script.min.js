!function(){function e(e){for(sPageURL=window.location.search.substring(1),sURLVariables=sPageURL.split("&"),i=0;i<sURLVariables.length;i++)if(sParameterName=sURLVariables[i].split("="),sParameterName[0]==e)return sParameterName[1]}function r(e){return e=e.replace(/<br\s*\/?>/gm,"\r\n"),e=e.replace(/[\r\n]+$/,"")}function a(e){e.data.indexOf("drop=")>-1?(alert(e.data),imageSrc=e.data.replace("drop=",""),formPicture.val(imageSrc),formImage.empty().css({"background-image":"url("+imageSrc+")"}).addClass("found").removeClass("hover").removeClass("error")):"enter"==e.data?formImage.addClass("hover"):"leave"==e.data?formImage.removeClass("hover"):"start"==e.data?formImage.addClass("start"):"end"==e.data?formImage.removeClass("start"):e.data.indexOf("name=")>-1?(theName=e.data.replace("name=",""),theName&&formName.val(theName)):e.data.indexOf("price=")>-1?(thePrice=e.data.replace("price=",""),""!=thePrice&&"undefined"!=thePrice&&formPrice.val(thePrice)):e.data.indexOf("currency=")>-1?(theCurrency=e.data.replace("currency=",""),""!=theCurrency&&"undefined"!=theCurrency&&formCurrency.val(theCurrency)):e.data.indexOf("description=")>-1?(theDescription=r(e.data.replace("description=","")),""!=theDescription&&"undefined"!=theDescription&&formDescription.val(theDescription)):e.data.indexOf("image=")>-1?(theImage=e.data.replace("image=",""),""!=theImage&&"undefined"!=theImage&&(formPicture.val(theImage),formImage.empty().css({"background-image":"url("+theImage+")"}).addClass("found").removeClass("hover"))):e.data.indexOf("url=")>-1&&(theOrigin=e.data.replace("url=",""),""!=theOrigin&&"undefined"!=theOrigin&&formOrigin.val(theOrigin))}function t(){return formPictureExtension=formPicture.val().split(".").pop().toLowerCase(),formPictureExtension=formPictureExtension.split("?")[0],formPictureExtension=formPictureExtension.split("#")[0],formPictureExtension=formPictureExtension.split("&")[0],alert(formPicture),$(".error").removeClass("error"),formName.removeClass("error"),formWishlist.removeClass("error"),errors={},""==formName.val()&&(errors.name="You must provide a name"),null==formWishlist.val()&&(errors.wishlist="You must select a wishlist"),""==formPicture.val()?errors.image="You must provide a picture":""!=formPicture.val()&&-1==$.inArray(formPictureExtension,["gif","png","jpg","jpeg"])&&(errors.image="The picture should be a .jpg, .png or .gif file"),errors.name&&formName.addClass("error"),errors.wishlist&&formWishlist.addClass("error"),errors.image&&$("#image").addClass("error"),errors.name||errors.wishlist||errors.image?(console.log(errors),!1):void(errors=0)}function o(){function e(){formWrapper.removeClass("fade"),alert("We couldn't add your wish.\nPlease reload the page and try again.")}function r(e){window.parent.postMessage("finished","*"),formWrapper.find(".loader").addClass("hide"),setTimeout(function(){window.parent.postMessage("height=222","*"),formHide.addClass("fade").delay(250).hide(),setTimeout(function(){formWrapper.removeClass("fade").addClass("hidden"),formImage.wrap('<a href="'+e+'" target="_blank"></a>'),formSubmit.val("Added !")},250)},250),form.on("submit",function(){window.open(e,"_blank")})}data=form.serialize(),formWrapper=$(".form_wrapper"),formHide=$(".form_hide"),formWrapper.addClass("fade"),formSubmit.val("Adding..."),sent=1,$.ajax({url:"/extension/add.php",type:"POST",data:data,success:function(i){"error"==i?e():r(i)},error:function(r){e()}})}container=$(".container"),form=$("form"),formImage=form.find("#image"),formPicture=form.find("#picture"),formOrigin=form.find("#origin"),formName=form.find("#name"),formPrice=form.find("#price"),formCurrency=form.find("#currency"),formWishlist=form.find("#wishlist"),formDescription=form.find("#description"),formSubmit=form.find("#submit"),$("select[name=wishlist]").on("change",function(){"setnew"==$(this).val()&&(new_wishlist_name=prompt("Please give this wishlist a name"),""!=new_wishlist_name&&null!=new_wishlist_name?($("input[id=new_wishlist]").remove(),$(this).after('<input id="new_wishlist" type="text" name="new_wishlist" value="'+new_wishlist_name+'" required />').siblings("#new_wishlist").hide(),$(this).children().last().before('<option value="new">'+new_wishlist_name+"</option>").prev().prop("selected",!0)):$(this).children().first().prop("selected",!0))}),domain=0,window.addEventListener("message",a,!1),sent=0,errors=0,form.on("submit",function(){return t(),0==sent&&0==errors&&o(),!1}),window.parent.postMessage("ready","*")}();